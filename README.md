# Automatic_Internet_tool

## 執行方式
1. 以系統管理員身分執行：雙擊 **Automatic_Internet_tool v1.0.5.exe**（或右鍵→以系統管理員執行）。

> 註：需管理員權限才能套用/還原網路設定與進行預測試（暫掛 IP、寫入臨時路由）。

---

## 功能

### 子網掃描
- 針對整個 CIDR（輸入 `192.168.<X>.0/24`，如 131 → 掃描 `192.168.131.2~253`）。
- 分出「已使用 / 可用」。
- 預設排除：
  - `.1`（路由器）
  - `.254`（閘道）
- 支援並行掃描（workers 可調）、逾時（timeout 可調）。

### 網卡選擇與相容性
- 自動列出「可用 IPv4」網卡（可選是否包含 Wi-Fi）。
- 支援中文介面名稱。
- 內建安全解碼，避免 `cp950` / `UnicodeDecodeError`。

### 「不變更現有設定」的預測試
- 對每個候選 IP：
  1. 暫掛別名（Alias）
  2. 新增臨時 `/32` 主機路由
  3. 嘗試真連線測試
  4. 測試後移除
- 模式可選：
  - `gateway_only`：只測 GW。
  - `internet`：只測外網目標。
  - `mixed`：先測 GW，再測部分外網。
  - `none`：跳過預測試。

### 測試目標來源（可自訂）
- 讀取 EXE 同資料夾的 `targets.txt`。
- 格式：`主機或IP:Port 說明`（支援主機名 → 會用網卡 DNS 解析）。
- 內建目標：
  - Google `8.8.8.8:53`
  - Cloudflare `1.1.1.1:443` / `1.0.0.1:443`
  - Quad9 `9.9.9.9:53`

### 一鍵套用網路設定
- 顯示預測試通過清單 → 使用者選擇要套用的 IP。
- 套用靜態 `IP/Mask/GW`。
- 套用 DNS：`8.8.8.8` + `1.1.1.1`（可修改）。
- 提供還原 DHCP 功能。

### 連線驗證與輸出
- 套用後再做外網檢查：
  - ICMP：`8.8.8.8`、`1.1.1.1`、`www.google.com`
  - TCP：`targets.txt` 與內建目標
- 結果全部輸出於命令列，最後停住等待 Enter。

### 錯誤處理
- 例外會輸出 traceback 並停住。
- 所有子程序輸出一律安全解碼，避免亂碼或崩潰。

---

## 使用說明（邏輯流程）

1. **啟動與權限檢查**  
   - 程式啟動會檢查是否為管理員。  
   - 若不是 → 自動嘗試提權（UAC），若拒絕則退出。  

2. **選擇網卡**  
   - 列出可用 IPv4 網卡（依 `INCLUDE_WIFI` 選項）。  
   - 使用者輸入編號或名稱選取。  

3. **輸入掃描網段**  
   - 例如輸入 `131` → 掃描 `192.168.131.2 ~ 253`。  
   - 輸出「佔用 / 可用 / 失敗」統計。  

4. **預測試**  
   - 對可用 IP 進行測試（依 `PRETEST_MODE`）。  
   - 結果標示：  
     - PASS → 可用  
     - FAIL → 顯示原因  

5. **套用設定**  
   - 從通過清單選擇要套用的 IP。  
   - 設定靜態 IP / GW / DNS。  

6. **驗證與結束**  
   - 套用後做 ICMP + TCP 測試。  
   - 輸出結果，停住等待 Enter。  

---

## 適用環境
- Windows 11 / Windows 10 22H2 以上（需系統管理員權限）。

---

## 檔案與設定

### `targets.txt`（可選）
- 放在 EXE 同資料夾。  
- 每行一個目標：txt
  proxy.company.local:8080 公司Proxy
  203.66.181.1:443 公司出口FW
  1.1.1.1:443 Cloudflare

* 主機名會用網卡 DNS 解析成 IP 後測試。
* 建議加入公司 Proxy 或可直連的內外部 IP\:Port。

---

## 更新紀錄

### v1.0.5 — 權限與模式調整

* 權限提昇邏輯調整，修正部分情況下「右鍵管理員執行」仍會退出的問題。
* `PRETEST_MODE` 預設改為 **`gateway_only`**，適合企業內網環境。
* 加入 `INCLUDE_WIFI` 開關，允許掃描/選取 Wi-Fi 介面。
* 新增 **統計輸出**（佔用/失敗/可用）。
* 調整使用流程，新增 **詳細邏輯流程說明**。

### v1.0.4 — 企業網路相容（Proxy/DNS/策略）

* 不再強制 DNS = 8.8.8.8，改為沿用公司 DNS（validate=no）。
* 新增 `targets.txt`，允許自訂測試目標。
* 內建測試目標改為以「網卡 DNS」與「系統 Proxy」為主。

### v1.0.3 — 「不變更現有設定」的預測試

* 新增預測試（暫掛 IP + /32 路由 + socket 綁定來源位址）。
* 模式支援 `internet` / `intranet`。
* 預測試通過清單讓使用者再選擇實際套用。

### v1.0.2 — 介面/編碼與 `netsh` 相容

* 列網卡改用 PowerShell，支援中文名稱。
* 修正 `cp950` / UnicodeDecodeError。
* `netsh set dnsservers` 語法修正。
* 掃描顯示整段可用 IP。

### v1.0.1 — 啟動/權限

* 加入自動提權（UAC），非管理員時提示並嘗試提權。

### v1.0.0 — 初版

* 掃描整個 CIDR，判斷使用/未用。
* 互動式選擇 IP，套用靜態設定（原先 DNS 固定 8.8.8.8）。
* 提供 `--list-iface`、`--dhcp`、`--workers`、`--timeout-ms`。
* 簡單外網檢查（ping 8.8.8.8 / [www.google.com）。](http://www.google.com）。)
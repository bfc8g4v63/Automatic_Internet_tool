# Automatic_Internet_tool

## 執行方式
1. 以系統管理員身分執行：雙擊 **Automatic_Internet_tool v1.0.6.exe**（或右鍵→以系統管理員執行）。

> 註：需管理員權限才能套用/還原網路設定與進行預測試（暫掛 IP、寫入臨時路由）。

---

## 功能

### 子網掃描
- 掃描輸入的 CIDR（例如輸入 `131` → 掃描 `192.168.131.2~253`）。  
- 自動分出：  
  - **已佔用**：有回應（Ping）  
  - **可用**：無回應  
- 預設排除：`.1`（路由器）、`.254`（閘道）  
- 支援並行掃描（workers 可調）、逾時（timeout 可調）。

### 狀態分級（中文顯示）
- **已佔用**：IP 已被使用  
- **可用**：無回應（候選 IP）  
- **內網可通**：能連到閘道  
- **可上網**：能連到外部目標  
- **不通**：完全無回應  

### 網卡選擇與相容性
- 自動列出可用 IPv4 網卡（可選是否包含 Wi-Fi）。  
- 支援中文介面名稱。  
- 內建安全解碼，避免 `cp950` / `UnicodeDecodeError`。  

### 預測試（暫掛 Alias）
- 對候選 IP 進行分層檢查：  
  1. 暫掛別名（Alias）  
  2. 新增臨時 `/32` 主機路由  
  3. 測試內網（Gateway Ping）  
  4. 測試外網（DNS/HTTPS，多目標）  
  5. 測試結束移除  
- 模式支援：  
  - `gateway_only`：只測 GW。  
  - `internet`：只測外網目標。  
  - `mixed`：先測 GW，再測外網（預設）。  
  - `none`：跳過預測試。  
  - （新）`lan_only`：僅測內網，不測外網。  

### 一鍵套用網路設定
- 掃描結束後，列出「內網可通 / 可上網」的 IP 清單。  
- 使用者輸入 **編號**（簡化，不需輸入完整 IP）。  
- 程式自動套用：  
  - 靜態 IP / Mask / Gateway  
  - DNS：`8.8.8.8` + `1.1.1.1`  

### 連線驗證與輸出
- 表格化輸出結果：  

```
IP 位址            使用狀態   內網   外網
----------------------------------------------
192.168.131.10     已佔用     ✔     -
192.168.131.11     可用       ✘     ✘
192.168.131.12     內網可通   ✔     ✘
192.168.131.13     可上網     ✔     ✔
```

- 統計輸出：  
  - 已佔用  
  - 可用/內網  
  - 可上網  
  - 不通  

---

## 使用說明（邏輯流程）

1. **啟動與權限檢查**  
   - 檢查是否為管理員，否則嘗試提權。  

2. **選擇網卡**  
   - 列出可用 IPv4 網卡，使用者輸入編號選取。  

3. **輸入掃描網段**  
   - 輸入 `131` → 掃描 `192.168.131.2 ~ 253`。  

4. **預測試**  
   - 對候選 IP 進行 Alias 測試。  
   - 依模式顯示「可用 / 內網可通 / 可上網 / 不通」。  

5. **套用設定**  
   - 列出可用清單 → 輸入編號選取。  
   - 自動設定靜態 IP / GW / DNS。  

6. **驗證與結束**  
   - 顯示結果表格與統計。  
   - 停住等待 Enter。  

---

## 適用環境
- Windows 11 / Windows 10 22H2 以上（需系統管理員權限）。

---

## 檔案與設定

### `targets.txt`（可選）
- 放在 EXE 同資料夾。  
- 每行一個目標，例如：  

```
proxy.company.local:8080 公司Proxy
203.66.181.1:443 公司出口FW
1.1.1.1:443 Cloudflare
```

* 主機名會用網卡 DNS 解析成 IP 後測試。  
* 建議加入公司 Proxy 或內外部可直連的 IP:Port。  

---

## 更新紀錄

### v1.0.6 — 狀態中文化與自動設定精簡
* 狀態顯示改為中文（可用、已佔用、內網可通、可上網、不通）。  
* 新增 `lan_only` 模式，支援純內網環境，不測外網。  
* 表格化輸出結果（IP / 狀態 / 內網 / 外網）。  
* 使用者僅需輸入編號即可套用靜態 IP + DNS。  
* 改善 alias 測試清理機制，避免殘留。  

### v1.0.5 — 權限與模式調整
* 權限提昇邏輯調整，修正部分情況下「右鍵管理員執行」仍會退出的問題。  
* `PRETEST_MODE` 預設改為 **`gateway_only`**。  
* 加入 `INCLUDE_WIFI` 開關，允許掃描/選取 Wi-Fi。  
* 新增統計輸出。  
* 調整使用流程，新增詳細邏輯流程說明。  

### v1.0.4 — 企業網路相容（Proxy/DNS/策略）

* 不再強制 DNS = 8.8.8.8，改為沿用公司 DNS（validate=no）。
* 新增 `targets.txt`，允許自訂測試目標。
* 內建測試目標改為以「網卡 DNS」與「系統 Proxy」為主。

### v1.0.3 — 「不變更現有設定」的預測試

* 新增預測試（暫掛 IP + /32 路由 + socket 綁定來源位址）。
* 模式支援 `internet` / `intranet`。
* 預測試通過清單讓使用者再選擇實際套用。

### v1.0.2 — 介面/編碼與 `netsh` 相容

* 列網卡改用 PowerShell，支援中文名稱。
* 修正 `cp950` / UnicodeDecodeError。
* `netsh set dnsservers` 語法修正。
* 掃描顯示整段可用 IP。

### v1.0.1 — 啟動/權限

* 加入自動提權（UAC），非管理員時提示並嘗試提權。

### v1.0.0 — 初版

* 掃描整個 CIDR，判斷使用/未用。
* 互動式選擇 IP，套用靜態設定（原先 DNS 固定 8.8.8.8）。
* 提供 `--list-iface`、`--dhcp`、`--workers`、`--timeout-ms`。
* 簡單外網檢查（ping 8.8.8.8 / [www.google.com）。](http://www.google.com）。)